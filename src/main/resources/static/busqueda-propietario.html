<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Búsqueda de propietario</title>
    <link rel="stylesheet" href="Estilos.css">
    <script src="vistaWeb.js"></script>
    <script defer src="utilesVista.js"></script>
</head>
<body>
    <div class="container">
        <h2>Búsqueda de propietario</h2>
        <form id="formBuscarPropietario" onsubmit="buscarPropietario(event)">
            <div class="form-group">
                <label for="cedulaPropietario">Cédula de identidad:</label>
                <input type="text" id="cedulaPropietario" name="cedula" required>
            </div>  
            <button type="submit">Buscar propietario</button>
        </form>
        <div id="resultadoBusqueda"></div>
    </div>
    <script>
        function buscarPropietario(event) {
            event.preventDefault();
            submit("/asignarBonificaciones/buscarPropietario", serializarFormulario("formBuscarPropietario"));
        }
        function procesarRespuestaSubmit(text) {
            let respuesta = typeof text === "string" ? JSON.parse(text) : text;
            if (respuesta.id === "resultadoBusqueda") {
                const dto = respuesta.parametro;
                let html;
                if (dto) {
                    // Llamar al padre para actualizar el panel principal
                    if (window.parent && typeof window.parent.seleccionarPropietario === "function") {
                        window.parent.seleccionarPropietario(dto);
                    }
                    let bonificacionesHtml = '';
                    if (dto.bonificacionesAsignadas && dto.bonificacionesAsignadas.length > 0) {
                        bonificacionesHtml = `<table><thead><tr><th>Bonificación</th><th>Puesto</th></tr></thead><tbody>`;
                        dto.bonificacionesAsignadas.forEach(b => {
                            bonificacionesHtml += `<tr><td>${b.bonificacion || b.nombreBonificacion}</td><td>${b.puesto || b.nombrePuesto}</td></tr>`;
                        });
                        bonificacionesHtml += `</tbody></table>`;
                    } else {
                        bonificacionesHtml = '<p>Sin bonificaciones asignadas</p>';
                    }
                    html = `
                        <div class=\"card\" style=\"margin-top:10px;\">
                            <h3>Propietario</h3>
                            <p><strong>Nombre:</strong> ${dto.nombreCompleto}</p>
                            <p><strong>Estado:</strong> ${dto.estado}</p>
                            <h4>Bonificaciones asignadas</h4>
                            ${bonificacionesHtml}
                        </div>
                    `;
                } else {
                    html = `<div class=\"card\"><p>No se encontró el propietario</p></div>`;
                }
                document.getElementById("resultadoBusqueda").innerHTML = html;
            }
        }
    </script>
</body>
</html>
